# 源码编写和编译

编码-编译-运行-调试.

## 编码

- mixal程序的文件编码格式是ascii
- mixal的编写是非常有趣的,看起来像表格一样
- 源码文件后缀是.mixal,这个后缀是可以被mdk识别的
- 每一行都被分成4块
- 如果想要更进一步,可以添加最后一列,表示行号

## 编译

mixal源码要先由mixal汇编器进行编译,之后才可以在
mix机器上运行.

mixasm hello 是编译命令.
如果编译出错,会有个hello.mix的二进制文件生成,
这个文件可用mixvm进行分析.

## 运行

mixvm/gmixvm/mixguile都可以来访问mix计算机模拟器.
下面重点描述mixvm.

mixvn是mix虚拟机,有两种模式:侵入式和非侵入式.
非侵入式,mixvm会将程序加载到内存并执行,遇到hlt指令就退出.
侵入式,mixvm会提供一个shell来进行交互.

### 非侵入式

mixvm -r hello,

- 指令中的-r表示非侵入式模式.
- -t,还可查看执行时间.
- -d, 还可将寄存器dump下来

在非侵入式下,是不能查看内存单元的,
不能单步指令,不能打断点.还是有限制的.

### 侵入式

不带参数的mixvm会进入侵入模式,这时会有一个shell.
shell是可以补全的,也有历史功能.

- 第一件事是加载mix程序: load hello
- pc是查看指令寄存器
- run是运行程序
- pmem 3000, 查看地址为3000的内存单元
  - pmem 3000-3500, 查看一定范围的内存单元

下面看看hello world的数据:

    MIX> pmem 3000-3006
    3000: + 46 58 00 19 37 (0786957541)
    3001: + 00 00 00 02 05 (0000000133)
    3002: + 14 09 27 01 13 (0237350989)
    3003: + 00 08 05 13 13 (0002118477)
    3004: + 16 00 26 16 19 (0268542995)
    3005: + 13 04 00 00 00 (0219152384)
    3006: + 00 00 00 00 00 (0000000000)

    3000:37对应OUT指令,19对应console 46x64+58=3002
        整个意思就是将3002的数据打印出来
    3001:opcode=5,mod=2 表示hlt指令
    3002:在3000的指令中已经将3002的内容当成了操作数
        就不能当成指令来翻译
    从内存中是无法看出3000中操作数的长度,下面继续看.

- preg A,查看A寄存器
  - 除了A,还可以查看X/I1/I6/J
  - overflow/cmp倒是没找到查看方法
- help 子命令
  - 查看帮助
  - help preg 确实不支持查看ov/cmp寄存器
